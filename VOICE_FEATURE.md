# 语音播报功能使用说明

## 功能概述

语音播报功能为视力不佳的老人提供语音提醒，提升无障碍体验。当提醒时间到达时，系统会自动播报提醒内容。

## 功能特性

### ✅ 已实现功能（Phase 1）

1. **自动播报**
   - 提醒时间到达时（±2 分钟内）自动播报
   - 避免重复播报（30 分钟内不会重复播报同一提醒）

2. **手动播报**
   - 每个提醒卡片上都有语音按钮
   - 点击按钮可以随时重新播报提醒内容

3. **浏览器兼容性检查**
   - 自动检测浏览器是否支持语音合成
   - 不支持时自动隐藏语音按钮

4. **中文语音优化**
   - 自动选择中文语音
   - 语速设置为 0.9，方便老人听清楚

## 使用方法

### 对于老人（展示页面）

1. **自动播报**：无需任何操作，提醒时间到达时自动播报
2. **手动播报**：点击提醒卡片右上角的 🔊 按钮，可以重新播报

### 对于管理员

目前 Phase 1 阶段，语音功能默认启用，无需额外配置。

## 技术实现

### 核心文件

- `lib/voice.ts` - 语音服务核心类
- `components/display/VoiceButton.tsx` - 语音按钮组件
- `components/display/ReminderCard.tsx` - 已集成语音按钮
- `app/display/page.tsx` - 已集成自动播报逻辑

### 数据库（可选）

Phase 1 阶段不需要修改数据库。如果需要记录语音播报日志，可以执行：

```sql
-- 执行迁移文件
supabase/migrations/002_add_voice_fields.sql
```

## 浏览器支持

### 支持的浏览器

- ✅ Chrome/Edge（推荐）
- ✅ Safari（iOS 7+）
- ✅ Firefox（部分支持）
- ❌ 旧版浏览器可能不支持

### 检查浏览器支持

在浏览器控制台运行：

```javascript
'speechSynthesis' in window
```

返回 `true` 表示支持。

## 播报内容格式

播报内容格式为：
```
现在是[时间]，[类型]提醒：[标题]。[描述]
```

示例：
- `现在是08:00，用药提醒：服用降压药。早餐后服用`
- `现在是14:00，检查提醒：测量血压`

## 未来计划（Phase 2-3）

- [ ] 语音设置页面（语速、音调、音量调节）
- [ ] 选择不同语音（男声/女声）
- [ ] 根据提醒类型选择不同语气
- [ ] 支持多语言播报
- [ ] 语音确认功能（"已服药"语音确认）
- [ ] 播报历史记录

## 故障排除

### 问题：没有自动播报

1. 检查浏览器是否支持语音合成
2. 检查浏览器是否允许自动播放（某些浏览器需要用户交互）
3. 检查控制台是否有错误信息

### 问题：语音按钮不显示

- 浏览器不支持语音合成功能
- 建议使用 Chrome 或 Edge 浏览器

### 问题：播报声音太小

- 调整系统音量
- Phase 2 将支持在应用内调节音量

## 开发说明

### 测试语音功能

1. 启动开发服务器：`npm run dev`
2. 访问展示页面：http://localhost:3000/display
3. 创建一个提醒，时间设置为当前时间后 1-2 分钟
4. 等待时间到达，应该会自动播报
5. 或点击语音按钮手动播报

### 自定义播报内容

修改 `lib/voice.ts` 中的 `speakReminder` 方法：

```typescript
speakReminder(
  title: string,
  type: string,
  time: string,
  description?: string
): Promise<void> {
  // 自定义播报内容格式
  const text = `您的${typeLabel}提醒：${title}，时间是${time}`
  return this.speak(text, { rate: 0.9 })
}
```

## 注意事项

1. **自动播报限制**：某些浏览器（如 Safari）需要用户先与页面交互才能自动播报
2. **重复播报**：同一提醒在 30 分钟内不会重复播报，避免打扰
3. **性能考虑**：语音播报不会影响页面性能，使用浏览器原生 API
